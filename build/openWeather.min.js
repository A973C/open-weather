/*!

Name: Open Weather
Dependencies: jQuery, OpenWeatherMap API
Author: Michael Lynch
Author URL: http://michaelynch.com
Date Created: August 28, 2013
Licensed under the MIT license

*/

(function(e){e.fn.openWeather=function(t){if(!this.length){return this}var n={descriptionTarget:null,maxTemperatureTarget:null,minTemperatureTarget:null,windSpeedTarget:null,humidityTarget:null,sunriseTarget:null,sunsetTarget:null,placeTarget:null,iconTarget:null,customIcons:null,units:"c",city:null,lat:null,lng:null};var r=this;var i=e(this);var s;r.settings={};r.settings=e.extend({},n,t);if(r.settings.city!=null){s="http://api.openweathermap.org/data/2.5/weather?q="+r.settings.city}else if(r.settings.lat!=null&&r.settings.lng!=null){s="http://api.openweathermap.org/data/2.5/weather?lat="+r.settings.lat+"&lon="+r.settings.lng}var o=function(e){var t=e*1e3;var n=new Date(t);var r=n.getHours();if(r>12){hoursRemaining=24-r;r=12-hoursRemaining}var i=n.getMinutes();i=i.toString();if(i.length<2){i=0+i}var s=r+":"+i;return s};e.ajax({type:"GET",url:s,dataType:"jsonp",success:function(t){if(r.settings.units=="f"){var n=Math.round((t.main.temp-273.15)*1.8+32)+"°F";var s=Math.round((t.main.temp_min-273.15)*1.8+32)+"°F";var u=Math.round((t.main.temp_max-273.15)*1.8+32)+"°F"}else{var n=Math.round(t.main.temp-273.15)+"°C";var s=Math.round(t.main.temp_min-273.15)+"°C";var u=Math.round(t.main.temp_max-273.15)+"°C"}i.html(n);if(r.settings.minTemperatureTarget!=null){e("#"+r.settings.minTemperatureTarget).text(s)}if(r.settings.maxTemperatureTarget!=null){e("#"+r.settings.maxTemperatureTarget).text(u)}e("#"+r.settings.descriptionTarget).text(t.weather[0].description);if(r.settings.iconTarget!=null&&t.weather[0].icon!=null){if(r.settings.customIcons!=null){var a=t.weather[0].icon;var f;var l;if(a.indexOf("d")!=-1){l="day"}else{l="night"}if(a=="01d"||a=="01n"){f="clear"}if(a=="02d"||a=="02n"||a=="03d"||a=="03n"||a=="04d"||a=="04n"){f="clouds"}if(a=="09d"||a=="09n"||a=="10d"||a=="10n"){f="rain"}if(a=="11d"||a=="11n"){f="storm"}if(a=="13d"||a=="13n"){f="snow"}if(a=="50d"||a=="50n"){f="mist"}var c=r.settings.customIcons+l+"/"+f+".png"}else{var c="http://openweathermap.org/img/w/"+t.weather[0].icon+".png"}e("#"+r.settings.iconTarget).attr("src",c)}if(r.settings.placeTarget!=null){e("#"+r.settings.placeTarget).text(t.name+", "+t.sys.country)}if(r.settings.windSpeedTarget!=null){e("#"+r.settings.windSpeedTarget).text(Math.round(t.wind.speed)+" Mph")}if(r.settings.humidityTarget!=null){e("#"+r.settings.humidityTarget).text(t.main.humidity+"%")}if(r.settings.sunriseTarget!=null){var h=o(t.sys.sunrise);e("#"+r.settings.sunriseTarget).text(h+" AM")}if(r.settings.sunsetTarget!=null){var p=o(t.sys.sunset);e("#"+r.settings.sunsetTarget).text(p+" PM")}}})}})(jQuery)