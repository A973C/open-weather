/*

Name: Open Weather
Dependencies: jQuery, OpenWeatherMap API
Author: Michael Lynch
Author URL: http://michaelynch.com
Date Created: August 28, 2013
Licensed under the MIT license

*/

(function(e){e.fn.openWeather=function(t){if(!this.length){return this}var n={descriptionTarget:null,maxTemperatureTarget:null,minTemperatureTarget:null,windSpeedTarget:null,humidityTarget:null,sunriseTarget:null,sunsetTarget:null,placeTarget:null,iconTarget:null,customIcons:null,units:"c",city:null,lat:null,lng:null};var r=this;var i=e(this);var s;r.settings={};r.settings=e.extend({},n,t);if(r.settings.city!=null){s="http://api.openweathermap.org/data/2.5/weather?q="+r.settings.city}else if(r.settings.lat!=null&&r.settings.lng!=null){s="http://api.openweathermap.org/data/2.5/weather?lat="+r.settings.lat+"&lon="+r.settings.lng}e.ajax({type:"GET",url:s,dataType:"jsonp",success:function(t){function p(e){var t=e*1e3;var n=new Date(t);var r=n.getHours();if(r>12){hoursRemaining=24-r;r=12-hoursRemaining}var i=n.getMinutes();i=i.toString();if(i.length<2){i=0+i}var s=r+":"+i;return s}if(r.settings.units=="f"){var n=Math.round((t.main.temp-273.15)*1.8+32)+"°F";var s=Math.round((t.main.temp_min-273.15)*1.8+32)+"°F";var o=Math.round((t.main.temp_max-273.15)*1.8+32)+"°F"}else{var n=Math.round(t.main.temp-273.15)+"°C";var s=Math.round(t.main.temp_min-273.15)+"°C";var o=Math.round(t.main.temp_max-273.15)+"°C"}i.html(n);if(r.settings.minTemperatureTarget!=null){e("#"+r.settings.minTemperatureTarget).text(s)}if(r.settings.maxTemperatureTarget!=null){e("#"+r.settings.maxTemperatureTarget).text(o)}e("#"+r.settings.descriptionTarget).text(t.weather[0].description);if(r.settings.iconTarget!=null&&t.weather[0].icon!=null){if(r.settings.customIcons!=null){var u=t.weather[0].icon;var a;var f;if(u.indexOf("d")!=-1){f="day"}else{f="night"}if(u=="01d"||u=="01n"){a="clear"}if(u=="02d"||u=="02n"||u=="03d"||u=="03n"||u=="04d"||u=="04n"){a="clouds"}if(u=="09d"||u=="09n"||u=="10d"||u=="10n"){a="rain"}if(u=="11d"||u=="11n"){a="storm"}if(u=="13d"||u=="13n"){a="snow"}if(u=="50d"||u=="50n"){a="mist"}var l=r.settings.customIcons+f+"/"+a+".png"}else{var l="http://openweathermap.org/img/w/"+t.weather[0].icon+".png"}e("#"+r.settings.iconTarget).attr("src",l)}if(r.settings.placeTarget!=null){e("#"+r.settings.placeTarget).text(t.name+", "+t.sys.country)}if(r.settings.windSpeedTarget!=null){e("#"+r.settings.windSpeedTarget).text(Math.round(t.wind.speed)+" Mph")}if(r.settings.humidityTarget!=null){e("#"+r.settings.humidityTarget).text(t.main.humidity+"%")}if(r.settings.sunriseTarget!=null){var c=p(t.sys.sunrise);e("#"+r.settings.sunriseTarget).text(c+" AM")}if(r.settings.sunsetTarget!=null){var h=p(t.sys.sunset);e("#"+r.settings.sunsetTarget).text(h+" PM")}}})}})(jQuery)